<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CAR REQUEST FORM ‚Äì Firebase Realtime</title>
<style>
*{box-sizing:border-box}
body{margin:0;font-family:'Segoe UI',Arial;background:#f2f4f8;min-height:100vh}
.login-box{max-width:380px;margin:120px auto;background:#fff;padding:30px;border-radius:18px;box-shadow:0 15px 35px rgba(0,0,0,.25)}
.login-box h2{text-align:center;margin-bottom:20px}
label{font-weight:600}
input,select,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #ccc;margin-bottom:12px}
textarea{resize:vertical}
.btn{padding:10px 18px;border:none;border-radius:20px;cursor:pointer;font-weight:600}
.btn-primary{background:#1d2671;color:#fff}
.btn-danger{background:#dc3545;color:#fff}
.btn-success{background:#28a745;color:#fff}
.password-wrap{display:flex;gap:6px}
#togglePass{border:none;background:#eee;border-radius:8px;padding:0 12px;cursor:pointer}
header{background:#0f2027;padding:16px 20px;display:flex;justify-content:space-between;align-items:center;color:#fff}
main{max-width:1200px;margin:auto;padding:30px}
.card{background:#fff;border-radius:22px;padding:26px;margin-bottom:26px;box-shadow:0 12px 30px rgba(0,0,0,.12)}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px}
th,td{padding:10px;border-bottom:1px solid #ddd;text-align:left}
th{background:#203a43;color:#fff}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginBox" class="login-box">
  <h2>Login Sistem</h2>
  <label>Username</label>
  <input id="username" placeholder="admin / user">
  <label>Password</label>
  <div class="password-wrap">
    <input id="password" type="password">
    <button id="togglePass" type="button">üëÅ</button>
  </div>
  <button class="btn btn-primary" style="width:100%" onclick="doLogin()">Login</button>
  <p id="loginMsg" style="color:red"></p>
</div>

<!-- APP -->
<div id="app" style="display:none">
<header>
  <h2>üöó CAR REQUEST FORM</h2>
  <button class="btn btn-danger" onclick="logout()">Logout</button>
</header>

<main>
  <div class="card">
    <h3>Form Booking Mobil</h3>
    <div class="grid">
      <input id="nama" placeholder="Nama Pemesan">
      <input id="kode" placeholder="Kode Booking">
      <input id="divisi" placeholder="Divisi">
      <input id="mobil" placeholder="Mobil">
      <input type="date" id="tglBooking">
      <input type="date" id="tglPakai">
    </div>
    <textarea id="tujuan" placeholder="Tujuan"></textarea>
    <button class="btn btn-success" onclick="simpan()">Simpan</button>
    <p id="msg"></p>
  </div>

  <div class="card">
    <h3>Data Booking (Realtime)</h3>
    <table width="100%">
      <thead>
        <tr>
          <th>Nama</th>
          <th>Kode</th>
          <th>Divisi</th>
          <th>Mobil</th>
          <th>Tgl Pakai</th>
          <th>Tujuan</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</main>
</div>

<script type="module">
/* ================= FIREBASE ================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyDkLSbuXI_XoQS_s4b0uVT_WfkLgRcQ058",
  authDomain: "booking-mobil-multigroup.firebaseapp.com",
  projectId: "booking-mobil-multigroup",
  storageBucket: "booking-mobil-multigroup.firebasestorage.app",
  messagingSenderId: "672379120256",
  appId: "1:672379120256:web:8b22dd01247cc6beaa5465"
};

const appFirebase = initializeApp(firebaseConfig);
const db = getFirestore(appFirebase);
const auth = getAuth(appFirebase);

/* ================= LOGIN ================= */
window.doLogin = async () => {
  try{
    await signInWithEmailAndPassword(auth, username.value + "@app.com", password.value);
  }catch(e){ loginMsg.innerText = "Login gagal"; }
}

onAuthStateChanged(auth, user => {
  if(user){
    loginBox.style.display = 'none';
    app.style.display = 'block';
  }
});

window.logout = async () => {
  await signOut(auth);
  location.reload();
}

/* ================= BOOKING ================= */
window.simpan = async () => {
  if(!nama.value || !kode.value || !mobil.value || !tglPakai.value){
    msg.innerText = "Lengkapi data";
    msg.style.color = "red";
    return;
  }

  await addDoc(collection(db, "bookings"), {
    nama: nama.value,
    kode: kode.value,
    divisi: divisi.value,
    mobil: mobil.value,
    tglBooking: tglBooking.value,
    tglPakai: tglPakai.value,
    tujuan: tujuan.value,
    createdAt: Date.now()
  });

  msg.innerText = "Tersimpan (Realtime)";
  msg.style.color = "green";
}

/* ================= REALTIME TABLE ================= */
const tbody = document.getElementById("tbody");
const q = query(collection(db, "bookings"), orderBy("createdAt", "desc"));

onSnapshot(q, (snap) => {
  tbody.innerHTML = "";
  snap.forEach(doc => {
    const b = doc.data();
    tbody.innerHTML += `
      <tr>
        <td>${b.nama}</td>
        <td>${b.kode}</td>
        <td>${b.divisi}</td>
        <td>${b.mobil}</td>
        <td>${b.tglPakai}</td>
        <td>${b.tujuan}</td>
      </tr>`;
  });
});

/* ================= UI ================= */
document.getElementById('togglePass').onclick = () => {
  password.type = password.type === 'password' ? 'text' : 'password';
}
</script>
</body>
</html>
